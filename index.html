<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>hashrock-calc</title>
  <link rel="stylesheet" href="https://unpkg.com/bootstrap@4.1.0/dist/css/bootstrap-reboot.min.css">
  <style>
  #app{
    margin: 0.5rem;
  }
  body{
    background: #EEE;
  }
  </style>
</head>

<body>

  <div id="app">
    <h1>16進数変換</h1>
    <div>
      <div>
        <input type="text" v-model="hex" @input="update('hex', $event)"> : 16進数 / hex
      </div>
      <div>
        <input type="text" v-model="decimal" @input="update('decimal', $event)"> : 10進数 / decimal
      </div>
      <div>
        <input type="text" v-model="binary" @input="update('binary', $event)"> : 2進数 / binary
      </div>
    </div>

    <h1>メモ帳</h1>
    <div>
        <textarea v-model="pasteboard" style="width: 100%; height: 10rem;"></textarea>
        <p>※LocalStorage自動保存</p>
    </div>

    <code>
      文字数： {{pasteboardLength}}<br>
      数値行合計: {{pasteboardSum}}
    </code>

  </div>


  <!-- development version, includes helpful console warnings -->
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>

  <script>
    new Vue({
      el: "#app",
      computed:{
        pasteboardLength(){
          if(!this.pasteboard){
            return 0
          }
          return this.pasteboard.replace(/\n/g, "").length
        },
        pasteboardSum(){
          if(!this.pasteboard){
            return 0
          }
          return this.pasteboard.split("\n").map((item)=>{
            if(item === ""){
              return 0
            }
            if(isNaN(item)){
              return 0
            }
            return parseFloat(item)
          }).reduce((a,b) => {
            return a+b
          })
        }
      },
      methods: {
        update(type, ev) {
          let val
          switch (type) {
            case "hex":
              val = this.hex.replace(/ /g, "");
              if (val) {
                this.decimal = parseInt(val, 16)
                this.binary = this.decimal.toString(2)
              }
              break;
            case "decimal":
              val = parseInt(this.decimal, 10)
              if (val) {
                this.hex = val.toString(16)
                this.binary = val.toString(2)
              }
              break;
            case "binary":
              val = this.binary.replace(/ /g, "");
              if (val) {
                this.decimal = parseInt(val, 2)
                this.hex = this.decimal.toString(16)
              }
              break;
          }
        }
      },
      data: {
        hex: "",
        decimal: "",
        binary: "",
        pasteboard: ""
      },
      watch:{
        pasteboard(value){
          localStorage.setItem("hashrock-calc__pasteboard", value)
        }
      },
      mounted(){
        if(localStorage.getItem("hashrock-calc__pasteboard")){
          this.pasteboard = localStorage.getItem("hashrock-calc__pasteboard")
        }
      }
    })

  </script>

</body>

</html>